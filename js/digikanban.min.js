function saveColumnName(a,o){var n=$("#ajax_actions_url").val(),i=window.saturne.toolbox.getToken(),e=$("#object_type").val(),t=o.closest(".kanban-column").getAttribute("category-id");$.ajax({url:n+"?action=rename_column&token="+i+"&category_name="+a.value+"&object_type="+e+"&category_id="+t,type:"POST",contentType:"application/json",success:function(n){o.innerText=a.value,o.style.display="inline",a.remove()},error:function(){console.log("Error saving card order.")}})}window.digikanban||(window.digikanban={},window.digikanban.scriptsLoaded=!1),window.digikanban.scriptsLoaded||(window.digikanban.init=function(){window.digikanban.load_list_script()},window.digikanban.load_list_script=function(){if(!window.digikanban.scriptsLoaded){var n=void 0,a=void 0;for(n in window.digikanban)for(a in window.digikanban[n].init&&window.digikanban[n].init(),window.digikanban[n])window.digikanban[n]&&window.digikanban[n][a]&&window.digikanban[n][a].init&&window.digikanban[n][a].init();window.digikanban.scriptsLoaded=!0}},window.digikanban.refresh=function(){var n=void 0,a=void 0;for(n in window.digikanban)for(a in window.digikanban[n].refresh&&window.digikanban[n].refresh(),window.digikanban[n])window.digikanban[n]&&window.digikanban[n][a]&&window.digikanban[n][a].refresh&&window.digikanban[n][a].refresh()},$(document).ready(window.digikanban.init)),window.digikanban.kanban={},window.digikanban.kanban.init=function(){window.digikanban.kanban.event()},window.digikanban.kanban.event=function(){$(document).on("change",".kanban-select-option",window.digikanban.kanban.selectOption),$(document).on("click",".validate-button:not(.butActionRefused)",window.digikanban.kanban.addObjectToColumn),$(".info-box").attr("draggable","true"),$(".kanban-column-body").sortable({connectWith:".kanban-column-body",placeholder:"kanban-placeholder",handle:".info-box",tolerance:"pointer",over:function(){$(this).css("cursor","grabbing")},stop:function(n,a){window.digikanban.kanban.saveCardOrder()}})},window.digikanban.kanban.saveCardOrder=function(){var n=$("#object_type").val();let o=[];$(".kanban-column").each(function(){var n=$(this).attr("category-id");let a=[];$(this).find(".info-box").each(function(){a.push($(this).find(".checkforselect").attr("value"))}),o.push({columnId:n,cards:a})});var a=$("#ajax_actions_url").val(),i=window.saturne.toolbox.getToken();$.ajax({url:a+"?action=move_object&token="+i+"&object_type="+n,type:"POST",data:JSON.stringify({order:o}),contentType:"application/json",success:function(n){console.log("Card order saved successfully.")},error:function(){console.log("Error saving card order.")}})},window.digikanban.kanban.addColumn=function(){let o=document.getElementById("kanban-board"),i="Nouvelle colonne";var n=$("#ajax_actions_url").val(),a=window.saturne.toolbox.getToken(),e=$("#object_type").val(),t=$("#main_category_id").val();$.ajax({url:n+"?action=add_column&token="+a+"&object_type="+e+"&category_id="+t,type:"POST",data:JSON.stringify({column_name:i}),contentType:"application/json",success:function(n){var a=document.createElement("div"),n=(a.classList.add("kanban-column"),a.setAttribute("category-id",n),a.innerHTML=`
                <div class="kanban-column-header">
                    <span class="column-name" onclick="window.digikanban.kanban.editColumn(this)">${i}</span>
                </div>
                <div class="kanban-column-body"></div>
                <div class="add-item">
                    <button onclick="window.digikanban.kanban.showSelect(this)">+ Ajouter un objet</button>
                </div>
            `,document.querySelector(".kanban-add-column"));o.insertBefore(a,n)},error:function(){console.log("Error adding column to the server.")}})},window.digikanban.kanban.editColumn=function(n){var a=n.innerText;let o=document.createElement("input");o.type="text",o.value=a,o.classList.add("column-name-input"),o.addEventListener("blur",function(){saveColumnName(o,n)}),n.style.display="none",n.parentNode.insertBefore(o,n),o.focus()},window.digikanban.kanban.selectOption=function(){var n=$(this).parent().find(".validate-button");n.removeClass("butActionRefused"),n.removeAttr("disabled")},window.digikanban.kanban.addObjectToColumn=function(){var n=$(this).parent().find(".kanban-select-option").val();let a=$(this).closest(".kanban-column").attr("category-id");var o=window.saturne.toolbox.getToken(),i=$("#object_type").val(),e=$("#ajax_actions_url").val();window.saturne.loader.display($(this).parent().find(".kanban-select-option")),e+="?action=add_object_to_column&object_id="+n+"&category_id="+a+"&token="+o+"&object_type="+i,$.ajax({url:e,type:"POST",processData:!1,contentType:!1,success:function(n){$('.kanban-column[category-id="'+a+'"]').find(".kanban-column-body").append(n),window.digikanban.kanban.refreshSelector(),$(".wpeo-loader").removeClass("wpeo-loader")},error:function(){console.log("Failed to add object to column.")}})},window.digikanban.kanban.refreshSelector=function(){var n=window.saturne.toolbox.getToken(),a=window.saturne.toolbox.getQuerySeparator(document.URL);let o=$(".kanban-board").find("form");$.ajax({url:document.URL+a+"token="+n,type:"POST",processData:!1,contentType:!1,success:function(a){o.each(function(){var n=$(this).find("select").attr("id");$(this).replaceWith($(a).find("#"+n).closest("form"))})},error:function(){console.log("Failed to refresh the selectors.")}})};