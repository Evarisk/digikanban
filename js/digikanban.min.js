function saveColumnName(a,e){var n=$("#ajax_actions_url").val(),o=window.saturne.toolbox.getToken(),i=$("#object_type").val(),t=e.closest(".kanban-column").getAttribute("category-id");$.ajax({url:n+"?action=rename_column&token="+o+"&category_name="+a.value+"&object_type="+i+"&category_id="+t,type:"POST",contentType:"application/json",success:function(n){e.innerText=a.value,e.style.display="inline",a.remove()},error:function(){console.log("Error saving card order.")}})}window.digikanban||(window.digikanban={},window.digikanban.scriptsLoaded=!1),window.digikanban.scriptsLoaded||(window.digikanban.init=function(){window.digikanban.load_list_script()},window.digikanban.load_list_script=function(){if(!window.digikanban.scriptsLoaded){var n=void 0,a=void 0;for(n in window.digikanban)for(a in window.digikanban[n].init&&window.digikanban[n].init(),window.digikanban[n])window.digikanban[n]&&window.digikanban[n][a]&&window.digikanban[n][a].init&&window.digikanban[n][a].init();window.digikanban.scriptsLoaded=!0}},window.digikanban.refresh=function(){var n=void 0,a=void 0;for(n in window.digikanban)for(a in window.digikanban[n].refresh&&window.digikanban[n].refresh(),window.digikanban[n])window.digikanban[n]&&window.digikanban[n][a]&&window.digikanban[n][a].refresh&&window.digikanban[n][a].refresh()},$(document).ready(window.digikanban.init)),window.digikanban.kanban={},window.digikanban.kanban.init=function(){window.digikanban.kanban.event()},window.digikanban.kanban.event=function(){$(document).on("change",".kanban-select-option",window.digikanban.kanban.selectOption),$(document).on("click",".validate-button:not(.butActionRefused)",window.digikanban.kanban.addObjectToColumn),$(".info-box").attr("draggable","true"),$(".kanban-column-body").sortable({connectWith:".kanban-column-body",placeholder:"kanban-placeholder",handle:".info-box",tolerance:"pointer",over:function(){$(this).css("cursor","grabbing")},stop:function(n,a){window.digikanban.kanban.saveCardOrder()}});let a=document.getElementById("kanban-board"),e=!1,o,i;a.addEventListener("mousedown",n=>{n.target.closest(".kanban-column, .kanban-column-header, .kanban-card, .kanban-select-option")||(e=!0,a.classList.add("dragging"),o=n.pageX-a.offsetLeft,i=a.scrollLeft)}),a.addEventListener("mousemove",n=>{e&&(n.preventDefault(),n=1.5*(n.pageX-a.offsetLeft-o),a.scrollLeft=i-n)}),a.addEventListener("mouseup",()=>{e=!1,a.classList.remove("dragging")}),a.addEventListener("mouseleave",()=>{e=!1,a.classList.remove("dragging")})},window.digikanban.kanban.saveCardOrder=function(){var n=$("#object_type").val();let e=[];$(".kanban-column").each(function(){var n=$(this).attr("category-id");let a=[];$(this).find(".info-box").each(function(){a.push($(this).find(".checkforselect").attr("value"))}),e.push({columnId:n,cards:a})});var a=$("#ajax_actions_url").val(),o=window.saturne.toolbox.getToken();$.ajax({url:a+"?action=move_object&token="+o+"&object_type="+n,type:"POST",data:JSON.stringify({order:e}),contentType:"application/json",success:function(n){console.log("Card order saved successfully.")},error:function(){console.log("Error saving card order.")}})},window.digikanban.kanban.addColumn=function(){let o=document.getElementById("kanban-board"),i="Nouvelle colonne";var n=$("#ajax_actions_url").val(),a=window.saturne.toolbox.getToken(),e=$("#object_type").val(),t=$("#main_category_id").val(),d=$("#post_name").val(),r=$("#object_linked_langs").val(),c=$("#object_array").val();$.ajax({url:n+"?action=add_column&token="+a+"&object_type="+e+"&category_id="+t,type:"POST",data:JSON.stringify({column_name:i,post_name:d,object_linked_langs:r,object_array:c}),contentType:"application/json",success:function(n){var n=JSON.parse(n),a=n.category_id,n=n.object_selector,e=document.createElement("div"),a=(e.classList.add("kanban-column"),e.setAttribute("category-id",a),e.innerHTML=`
                <div class="kanban-column-header">
                    <span class="column-name" onclick="window.digikanban.kanban.editColumn(this)">${i}</span>
                </div>
                <div class="kanban-column-body"></div>
                <div class="add-item">
                    <form method="POST" action="add_object_to_kanban.php">
                        ${n}
                        <button type="button" disabled class="butAction butActionRefused validate-button">Valider</button>
                    </form>
                </div>
            `,document.querySelector(".kanban-add-column")),n=(o.insertBefore(e,a),e.querySelector("select"));n&&$(n).select2({width:"resolve",minimumInputLength:0})},error:function(){console.log("Error adding column to the server.")}})},window.digikanban.kanban.editColumn=function(n){var a=n.innerText;let e=document.createElement("input");e.type="text",e.value=a,e.classList.add("column-name-input"),e.addEventListener("blur",function(){saveColumnName(e,n)}),n.style.display="none",n.parentNode.insertBefore(e,n),e.focus()},window.digikanban.kanban.selectOption=function(){var n=$(this).parent().find(".validate-button");n.removeClass("butActionRefused"),n.removeAttr("disabled")},window.digikanban.kanban.addObjectToColumn=function(){var n=$(this).parent().find(".kanban-select-option").val();let a=$(this).closest(".kanban-column").attr("category-id");var e=window.saturne.toolbox.getToken(),o=$("#object_type").val(),i=$("#ajax_actions_url").val();window.saturne.loader.display($(this).parent().find(".kanban-select-option")),i+="?action=add_object_to_column&object_id="+n+"&category_id="+a+"&token="+e+"&object_type="+o,$.ajax({url:i,type:"POST",processData:!1,contentType:!1,success:function(n){$('.kanban-column[category-id="'+a+'"]').find(".kanban-column-body").append(n),window.digikanban.kanban.refreshSelector().then(()=>{$(".wpeo-loader").removeClass("wpeo-loader")}).catch(()=>{console.log("Error refreshing selectors."),$(".wpeo-loader").removeClass("wpeo-loader")})},error:function(){console.log("Failed to add object to column."),$(".wpeo-loader").removeClass("wpeo-loader")}})},window.digikanban.kanban.refreshSelector=function(){return new Promise((n,a)=>{var e=window.saturne.toolbox.getToken(),o=window.saturne.toolbox.getQuerySeparator(document.URL);let i=$(".kanban-board").find("form");$.ajax({url:document.URL+o+"token="+e,type:"POST",processData:!1,contentType:!1,success:function(a){i.each(function(){var n=$(this).find("select").attr("id");$(this).replaceWith($(a).find("#"+n).closest("form"))}),n()},error:function(){console.log("Failed to refresh the selectors."),a()}})})};