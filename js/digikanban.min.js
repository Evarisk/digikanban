function saveColumnName(e,a){var n=$("#ajax_actions_url").val(),o=window.saturne.toolbox.getToken(),t=$("#object_type").val(),i=a.closest(".kanban-column").getAttribute("category-id");$.ajax({url:n+"?action=rename_column&token="+o+"&category_name="+e.value+"&object_type="+t+"&category_id="+i,type:"POST",contentType:"application/json",success:function(n){a.innerText=e.value,a.style.display="inline",e.remove()},error:function(){console.log("Error saving card order.")}})}window.digikanban||(window.digikanban={},window.digikanban.scriptsLoaded=!1),window.digikanban.scriptsLoaded||(window.digikanban.init=function(){window.digikanban.load_list_script()},window.digikanban.load_list_script=function(){if(!window.digikanban.scriptsLoaded){var n=void 0,e=void 0;for(n in window.digikanban)for(e in window.digikanban[n].init&&window.digikanban[n].init(),window.digikanban[n])window.digikanban[n]&&window.digikanban[n][e]&&window.digikanban[n][e].init&&window.digikanban[n][e].init();window.digikanban.scriptsLoaded=!0}},window.digikanban.refresh=function(){var n=void 0,e=void 0;for(n in window.digikanban)for(e in window.digikanban[n].refresh&&window.digikanban[n].refresh(),window.digikanban[n])window.digikanban[n]&&window.digikanban[n][e]&&window.digikanban[n][e].refresh&&window.digikanban[n][e].refresh()},$(document).ready(window.digikanban.init)),window.digikanban.kanban={},window.digikanban.kanban.init=function(){window.digikanban.kanban.event()},window.digikanban.kanban.event=function(){if(!$(".disable-kanban-actions").val()){$(document).on("change",".kanban-select-option",window.digikanban.kanban.selectOption),$(document).on("click",".validate-button:not(.butActionRefused)",window.digikanban.kanban.addObjectToColumn),$(".info-box").attr("draggable","true"),$(".kanban-column-body").sortable({connectWith:".kanban-column-body",placeholder:"kanban-placeholder",handle:".info-box",tolerance:"pointer",over:function(){$(this).css("cursor","grabbing")},stop:function(n,e){window.digikanban.kanban.saveCardOrder()}});let e=document.getElementById("kanban-board"),a=!1,o,t;e.addEventListener("mousedown",n=>{n.target.closest(".kanban-column, .kanban-column-header, .kanban-card, .kanban-select-option")||(a=!0,e.classList.add("dragging"),o=n.pageX-e.offsetLeft,t=e.scrollLeft)}),e.addEventListener("mousemove",n=>{a&&(n.preventDefault(),n=1.5*(n.pageX-e.offsetLeft-o),e.scrollLeft=t-n)}),e.addEventListener("mouseup",()=>{a=!1,e.classList.remove("dragging")}),e.addEventListener("mouseleave",()=>{a=!1,e.classList.remove("dragging")})}},window.digikanban.kanban.saveCardOrder=function(){var n=$("#object_type").val();let a=[];$(".kanban-column").each(function(){var n=$(this).attr("category-id");let e=[];$(this).find(".info-box").each(function(){e.push($(this).find(".checkforselect").attr("value"))}),a.push({columnId:n,cards:e})});var e=$("#ajax_actions_url").val(),o=window.saturne.toolbox.getToken();$.ajax({url:e+"?action=move_object&token="+o+"&object_type="+n,type:"POST",data:JSON.stringify({order:a}),contentType:"application/json",success:function(){console.log("Card order saved successfully.");for(let n=0;n<a.length;n++)$('.kanban-column[category-id="'+a[n].columnId+'"]').find(".column-counter").text(a[n].cards.length)},error:function(){console.log("Error saving card order.")}})},window.digikanban.kanban.addColumn=function(){let o=document.getElementById("kanban-board"),t="Nouvelle colonne";var n=$("#ajax_actions_url").val(),e=window.saturne.toolbox.getToken(),a=$("#object_type").val(),i=$("#main_category_id").val(),d=$("#post_name").val(),r=$("#object_linked_langs").val(),c=$("#object_array").val();$.ajax({url:n+"?action=add_column&token="+e+"&object_type="+a+"&category_id="+i,type:"POST",data:JSON.stringify({column_name:t,post_name:d,object_linked_langs:r,object_array:c}),contentType:"application/json",success:function(n){var n=JSON.parse(n),e=n.category_id,n=n.object_selector,a=document.createElement("div"),e=(a.classList.add("kanban-column"),a.setAttribute("category-id",e),a.innerHTML=`
                <div class="kanban-column-header">
                    <span class="column-name" onclick="window.digikanban.kanban.editColumn(this)">${t}</span>
                </div>
                <div class="kanban-column-body"></div>
                <div class="add-item">
                    <form method="POST" action="add_object_to_kanban.php">
                        ${n}
                        <button type="button" disabled class="butAction butActionRefused validate-button">Valider</button>
                    </form>
                </div>
            `,document.querySelector(".kanban-add-column")),n=(o.insertBefore(a,e),a.querySelector("select"));n&&$(n).select2({width:"resolve",minimumInputLength:0})},error:function(){console.log("Error adding column to the server.")}})},window.digikanban.kanban.editColumn=function(e){let a=$(e).closest(".kanban-column").find(".column-name")[0];if(a){var o=a.innerText.trim();let n=document.createElement("input");n.type="text",n.value=o,n.classList.add("column-name-input"),n.addEventListener("blur",function(){saveColumnName(n,a)}),$(e).closest(".kanban-column").find(".column-menu").addClass("hidden"),a.style.display="none",a.parentNode.insertBefore(n,a),n.focus()}else console.error("Erreur : Impossible de trouver l'élément column-name.")},window.digikanban.kanban.selectOption=function(){var n=$(this).parent().find(".validate-button");n.removeClass("butActionRefused"),n.removeAttr("disabled")},window.digikanban.kanban.addObjectToColumn=function(){var n=$(this).parent().find(".kanban-select-option").val();let e=$(this).closest(".kanban-column").attr("category-id");var a=window.saturne.toolbox.getToken(),o=$("#object_type").val(),t=$("#ajax_actions_url").val();window.saturne.loader.display($(this).parent().find(".kanban-select-option")),t+="?action=add_object_to_column&object_id="+n+"&category_id="+e+"&token="+a+"&object_type="+o;let i=$(this).closest(".kanban-column").find(".column-counter");$.ajax({url:t,type:"POST",processData:!1,contentType:!1,success:function(n){$('.kanban-column[category-id="'+e+'"]').find(".kanban-column-body").append(n),window.digikanban.kanban.refreshSelector().then(()=>{$(".wpeo-loader").removeClass("wpeo-loader")}).catch(()=>{console.log("Error refreshing selectors."),$(".wpeo-loader").removeClass("wpeo-loader")}),i.text(parseInt(i.text())+1)},error:function(){console.log("Failed to add object to column."),$(".wpeo-loader").removeClass("wpeo-loader")}})},window.digikanban.kanban.refreshSelector=function(){return new Promise((n,e)=>{var a=window.saturne.toolbox.getToken(),o=window.saturne.toolbox.getQuerySeparator(document.URL);let t=$(".kanban-board").find("form");$.ajax({url:document.URL+o+"token="+a,type:"POST",processData:!1,contentType:!1,success:function(e){t.each(function(){var n=$(this).find("select").attr("id");$(this).replaceWith($(e).find("#"+n).closest("form"))}),n()},error:function(){console.log("Failed to refresh the selectors."),e()}})})},window.digikanban.kanban.toggleColumnMenu=function(n){n=n.nextElementSibling;n.classList.contains("hidden")?(document.querySelectorAll(".column-menu").forEach(n=>n.classList.add("hidden")),n.classList.remove("hidden")):n.classList.add("hidden")},window.digikanban.kanban.deleteColumn=function(n){let e=n.closest(".kanban-column");var n=e.getAttribute("category-id"),a=$("#ajax_actions_url").val(),o=$("#token").val(),t=$("#object_type").val();confirm("Êtes-vous sûr de vouloir supprimer cette colonne ?")&&$.ajax({url:a+`?action=delete_column&token=${o}&category_id=${n}&object_type=`+t,type:"POST",success:function(){e.remove(),alert("Colonne supprimée avec succès.")},error:function(){alert("Erreur lors de la suppression de la colonne.")}})},document.addEventListener("click",function(n){n.target.closest(".kanban-column-header")||document.querySelectorAll(".column-menu").forEach(n=>n.classList.add("hidden"))}),window.digikanban.kanban.toggleCardMenu=function(n){n=n.nextElementSibling;n.classList.contains("hidden")?(document.querySelectorAll(".card-menu").forEach(n=>n.classList.add("hidden")),n.classList.remove("hidden")):n.classList.add("hidden")},window.digikanban.kanban.deleteCard=function(n){let e=n.closest(".kanban-card");var a=n.getAttribute("data-card-id"),o=$("#ajax_actions_url").val(),t=$("#token").val(),i=$("#object_type").val(),d=e.closest(".kanban-column").getAttribute("category-id");let r=$(n).closest(".kanban-column").find(".column-counter");confirm("Êtes-vous sûr de vouloir supprimer cette carte ?")&&$.ajax({url:o+`?action=remove_card_from_kanban&token=${t}&object_id=${a}&object_type=${i}&category_id=`+d,type:"POST",success:function(){e.remove(),alert("Carte supprimée avec succès."),r.text(parseInt(r.text())-1)},error:function(){alert("Erreur lors de la suppression de la carte.")}})},document.addEventListener("click",function(n){n.target.closest(".kanban-card-header")||document.querySelectorAll(".card-menu").forEach(n=>n.classList.add("hidden"))});